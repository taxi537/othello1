<script>
const shifts = [
  {name:"Danyall Abbasi",rank:"Taxi Director",times:[{days:"همه روزها",start:"20:00",end:"23:00"}]},
  {name:"Kourosh Zabeti",rank:"Taxi Deputy Director",times:[{days:"همه روزها",start:"14:00",end:"17:00"}]},
  {name:"Parham Azizi",rank:"Taxi Attendant",times:[{days:"همه روزها",start:"12:00",end:"12:01"}]},
  {name:"Abbas Abbasi",rank:"Taxi Attendant",times:[
      {days:"همه روزها",start:"12:00",end:"14:00"},
      {days:"همه روزها",start:"16:00",end:"17:00"}
  ]},
  {name:"Parsa Rahimi",rank:"Taxi Attendant",times:[{days:"همه روزها",start:"12:00",end:"15:00"}]}
];

const rankOrder = {
  "Taxi Director": 1,
  "Taxi Deputy Director": 2,
  "Taxi Manager": 3,
  "Taxi Attendant": 4
};

function $(s){return document.querySelector(s);}
function toPersianDigits(str){return String(str).replace(/\d/g,d=>"۰۱۲۳۴۵۶۷۸۹"[d]);}
function timeToMins(t){const [h,m]=t.split(":").map(Number);return h*60+m;}
function isEvenDay(date){
  const day = date.getDay();
  return [6,1,3,5].includes(day);
}

function updateClock(){
  const now=new Date();
  $("#clock").textContent=`${toPersianDigits(String(now.getHours()).padStart(2,"0"))}:${toPersianDigits(String(now.getMinutes()).padStart(2,"0"))}:${toPersianDigits(String(now.getSeconds()).padStart(2,"0"))}`;
}

function renderFullSchedule(){
  const tbody=$("#full-schedule tbody");
  tbody.innerHTML=shifts.slice().sort((a,b)=>(rankOrder[a.rank]||99)-(rankOrder[b.rank]||99))
  .map(p=>p.times.map(t=>`
    <tr>
      <td>${p.name}</td>
      <td>${p.rank}</td>
      <td>${t.days}</td>
      <td>${toPersianDigits(t.start)} تا ${toPersianDigits(t.end)}</td>
    </tr>`).join("")).join("");
}

function renderCurrentShifts(){
  const now=new Date();
  const curMins=now.getHours()*60+now.getMinutes();
  const even=isEvenDay(now);
  const active=[];
  shifts.forEach(p=>{
    p.times.forEach(t=>{
      let match=false;
      if(t.days==="همه روزها") match=true;
      if(t.days==="روز زوج"&&even) match=true;
      if(t.days==="روز فرد"&&!even) match=true;
      if(!match) return;
      const start=timeToMins(t.start),end=timeToMins(t.end);
      if(curMins>=start&&curMins<end){
        const remain=end-curMins;
        const rh=Math.floor(remain/60),rm=remain%60;
        active.push(`${p.name} (${p.rank}) - ${rh>0?toPersianDigits(rh)+" ساعت و ":""}${toPersianDigits(rm)} دقیقه مانده`);
      }
    });
  });
  $("#shift-list").innerHTML=active.length?active.map(x=>`<div>${x}</div>`).join(""):"<div>در حال حاضر کسی در شیفت نیست</div>";
}

updateClock(); renderFullSchedule(); renderCurrentShifts();
setInterval(updateClock,1000);
setInterval(renderCurrentShifts,1000);
</script>
