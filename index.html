<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>سیستم بررسی شیفت‌های تاکسی — ورود</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap");

    :root{
      --taxi-yellow:#ffcc00;
      --taxi-dark:#2b2b2b;
    }
    *{box-sizing:border-box}
    body {
      margin:0;
      font-family:"Vazirmatn",sans-serif;
      color:#fff;
      text-align:center;
      background: linear-gradient(135deg, #ffcc00 0%, #000 100%);
      overflow-x: hidden;
      min-height:100vh;
    }

    /* --- LOGIN OVERLAY --- */
    #login-overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.75);
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .login-card{
      width:100%;
      max-width:420px;
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border:2px solid rgba(0,0,0,0.6);
      padding:28px;
      border-radius:14px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.7);
      text-align:center;
    }
    .login-card h2{ margin:0 0 12px; color:var(--taxi-yellow); font-size:22px; }
    .login-card p{ margin:0 0 18px; color:#ddd; font-size:13px }

    .field{
      display:flex; gap:8px; align-items:center;
      background: rgba(0,0,0,0.45);
      border-radius:10px; padding:8px 12px; margin-bottom:12px;
      border:1px solid rgba(255,255,255,0.03);
    }
    .field input{
      width:100%; border:0; outline:none; background:transparent;
      color:#fff; font-size:15px; padding:6px 4px;
    }
    .btn {
      background:var(--taxi-dark);
      color:var(--taxi-yellow);
      border:2px solid var(--taxi-yellow);
      padding:10px 16px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 6px 0 rgba(0,0,0,0.5);
    }
    .btn:active{ transform:translateY(2px) }

    .msg{ margin-top:10px; font-size:13px; color:#ffcccb; min-height:18px }

    /* --- BACKGROUND DESIGN & MAIN PAGE --- */
    body::before {
      content:"";
      position:fixed;
      top:0; left:0; width:100%; height:100%;
      background-image: 
        linear-gradient(45deg, rgba(0,0,0,0.18) 25%, transparent 25%),
        linear-gradient(-45deg, rgba(0,0,0,0.18) 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, rgba(0,0,0,0.18) 75%),
        linear-gradient(-45deg, transparent 75%, rgba(0,0,0,0.18) 75%);
      background-size:40px 40px;
      z-index:0;
    }

    #balls-bg {
      position: fixed;
      top:0; left:0; width:100%; height:100%;
      z-index:0;
      pointer-events: none;
    }
    .ball {
      position: absolute;
      border-radius: 50%;
      width:80px; height:80px;
      background: radial-gradient(circle at center, #fff200, #ff8800);
      display:flex; align-items:center; justify-content:center;
      color:#000; font-weight:bold;
      font-size:18px;
      animation: float 8s linear infinite;
      text-shadow:0 0 5px #fff;
    }
    .ball:nth-child(1){top:10%;left:15%;animation-duration:6s;}
    .ball:nth-child(2){top:50%;left:65%;animation-duration:9s;}
    .ball:nth-child(3){top:30%;left:80%;animation-duration:11s;}
    .ball:nth-child(4){top:70%;left:30%;animation-duration:13s;}
    @keyframes float{ 0%{transform: translateY(0) rotate(0deg);} 50%{transform: translateY(-40px) rotate(180deg);} 100%{transform: translateY(0) rotate(360deg);} }

    header, .section{ position: relative; z-index:1; }
    header {
      padding:20px;
      font-weight:bold;
      background: rgba(0,0,0,0.7);
      border-bottom: 2px solid #ffcc00;
      position: sticky;
      top:0;
    }
    .title { font-size:2.3rem; margin-bottom:10px; color:#ffcc00; text-shadow:0 0 15px #000,0 0 25px #ffcc00; }
    .clock { font-size:3rem; font-weight:bold; color:#fff200; text-shadow:0 0 15px #000,0 0 25px #ff8800; }
    .section { background: rgba(0,0,0,0.65); margin:20px auto; padding:20px; border-radius:20px; width:90%; max-width:900px; border: 2px solid #ffcc00; box-shadow:0 8px 30px rgba(0,0,0,0.7); }
    h2{ color:#ffcc00; text-shadow:0 0 10px #000; }
    table { width:100%; border-collapse: collapse; margin-top:15px; }
    th,td { padding:12px; border-bottom:1px solid rgba(255,255,255,0.1); text-align:center; color:#fff }
    table th { background: linear-gradient(135deg, #ffcc00, #000); color:#000; }
    tr:hover{ background: rgba(255,204,0,0.1); }

    /* small responsive */
    @media (max-width:480px){
      .login-card{ padding:18px }
      .title{ font-size:1.6rem }
      .clock{ font-size:1.6rem }
    }
  </style>
</head>
<body>
  <!-- LOGIN OVERLAY -->
  <div id="login-overlay" role="dialog" aria-modal="true">
    <div class="login-card">
      <h2>ورود به پنل</h2>
      <p>برای مشاهده‌ی سیستم لطفاً وارد شوید</p>

      <div class="field"><input id="username" placeholder="نام کاربری" autocomplete="username" /></div>
      <div class="field"><input id="password" type="password" placeholder="رمز عبور" autocomplete="current-password" /></div>

      <div style="display:flex;gap:10px;justify-content:center;align-items:center;">
        <button id="loginBtn" class="btn">ورود</button>
        <button id="clearBtn" class="btn" style="background:transparent;color:#fff;border:2px solid rgba(255,255,255,0.12)">پاک کردن</button>
      </div>

      <div class="msg" id="loginMsg" aria-live="polite"></div>
      <div style="margin-top:12px;font-size:12px;color:#ddd">یوزرنیم: <b>Danirx</b> — پسورد: <b>dk13881388</b></div>
    </div>
  </div>

  <!-- BACKGROUND ORBS -->
  <div id="balls-bg" aria-hidden="true">
    <div class="ball">TAXI</div>
    <div class="ball">TAXI</div>
    <div class="ball">TAXI</div>
    <div class="ball">TAXI</div>
  </div>

  <!-- MAIN CONTENT -->
  <header>
    <div class="title">سیستم بررسی شیفت‌های تاکسی</div>
    <div class="clock" id="clock">۰۰:۰۰:۰۰</div>
  </header>

  <div class="section" id="current-shifts">
    <h2>شیفت فعلی</h2>
    <div id="shift-list">در حال بررسی...</div>
  </div>

  <div class="section" id="schedule-section">
    <h2>جدول کامل شیفت‌ها</h2>
    <table id="full-schedule">
      <thead>
        <tr><th>نام</th><th>رنک</th><th>روز / حالت</th><th>ساعت</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // ---------- CREDENTIALS (CLIENT-SIDE) ----------
    const AUTH_USER = "Danirx";
    const AUTH_PASS = "dk13881388";

    // DOM
    const overlay = document.getElementById("login-overlay");
    const usernameInput = document.getElementById("username");
    const passwordInput = document.getElementById("password");
    const loginBtn = document.getElementById("loginBtn");
    const clearBtn = document.getElementById("clearBtn");
    const loginMsg = document.getElementById("loginMsg");

    // If already authenticated in this session, hide overlay
    if (sessionStorage.getItem("taxi_auth") === "1") {
      overlay.style.display = "none";
    } else {
      overlay.style.display = "flex";
      // autofocus username
      usernameInput.focus();
    }

    function showMsg(text, ok = false) {
      loginMsg.textContent = text;
      loginMsg.style.color = ok ? "#bffcc6" : "#ffb6b6";
    }

    function attemptLogin() {
      const u = usernameInput.value.trim();
      const p = passwordInput.value;
      if (!u || !p) {
        showMsg("هر دو مقدار مورد نیاز است.");
        return;
      }
      if (u === AUTH_USER && p === AUTH_PASS) {
        // success
        sessionStorage.setItem("taxi_auth", "1");
        showMsg("ورود موفق. ...", true);
        setTimeout(() => { overlay.style.display = "none"; initApp(); }, 350);
      } else {
        showMsg("نام کاربری یا رمز اشتباه است.");
        passwordInput.value = "";
        passwordInput.focus();
      }
    }

    loginBtn.addEventListener("click", attemptLogin);
    passwordInput.addEventListener("keydown", e => { if (e.key === "Enter") attemptLogin(); });
    usernameInput.addEventListener("keydown", e => { if (e.key === "Enter") passwordInput.focus(); });
    clearBtn.addEventListener("click", () => { usernameInput.value = ""; passwordInput.value = ""; usernameInput.focus(); });

    // ---------- MAIN APP ----------
    function initApp(){
      // start app only after login or if session already set
      renderFullSchedule();
      renderCurrentShifts();
      updateClock();
      setInterval(updateClock,1000);
      setInterval(renderCurrentShifts,1000);
    }

    // Data
    const shifts = [
      {name:"Danyall Abbasi",rank:"Taxi Director",times:[{days:"همه روزها",start:"20:00",end:"23:00"}]},
      {name:"Kourosh Zabeti",rank:"Taxi Deputy Director",times:[{days:"همه روزها",start:"14:00",end:"17:00"}]},
      {name:"Parham Azizi",rank:"Taxi Attendant",times:[{days:"همه روزها",start:"12:00",end:"12:01"}]},
      {name:"Abbas Abbasi",rank:"Taxi Attendant",times:[{days:"همه روزها",start:"12:00",end:"15:00"}]},
      {name:"Parsa Rahimi",rank:"Taxi Attendant",times:[{days:"همه روزها",start:"12:00",end:"15:00"}]},
      {name:"Taha Azizii",rank:"Taxi Attendant",times:[{days:"همه روزها",start:"9:00",end:"12:00"}]},
      {name:"Arya Khazeie",rank:"Taxi Attendant",times:[{days:"همه روزها",start:"20:30",end:"23:30"}]}
    ];

    const rankOrder = {"Taxi Director":1,"Taxi Deputy Director":2,"Taxi Manager":3,"Taxi Attendant":4};

    // helpers
    const $ = s => document.querySelector(s);
    const toPersianDigits = str => String(str).replace(/\d/g,d=>"۰۱۲۳۴۵۶۷۸۹"[d]);
    const timeToMins = t => { const [h,m] = t.split(":").map(Number); return h*60 + (m||0); };
    const isEvenDay = date => [6,1,3,5].includes(date.getDay());

    function updateClock(){
      const now=new Date();
      $("#clock").textContent = `${toPersianDigits(String(now.getHours()).padStart(2,"0"))}:${toPersianDigits(String(now.getMinutes()).padStart(2,"0"))}:${toPersianDigits(String(now.getSeconds()).padStart(2,"0"))}`;
    }

    function renderFullSchedule(){
      const tbody = $("#full-schedule tbody");
      tbody.innerHTML = shifts.slice().sort((a,b)=>(rankOrder[a.rank]||99)-(rankOrder[b.rank]||99))
        .map(p => p.times.map(t => `
          <tr>
            <td>${p.name}</td>
            <td>${p.rank}</td>
            <td>${t.days}</td>
            <td>${toPersianDigits(t.start)} تا ${toPersianDigits(t.end)}</td>
          </tr>`).join("")).join("");
    }

    function renderCurrentShifts(){
      const now = new Date();
      const curMins = now.getHours()*60 + now.getMinutes();
      const even = isEvenDay(now);
      const active = [];

      shifts.forEach(p=>{
        p.times.forEach(t=>{
          let match=false;
          if (t.days==="همه روزها") match=true;
          if (t.days==="روز زوج" && even) match=true;
          if (t.days==="روز فرد" && !even) match=true;
          if (!match) return;
          const start = timeToMins(t.start), end = timeToMins(t.end);
          if (curMins >= start && curMins < end) {
            const remain = end - curMins;
            const rh = Math.floor(remain/60), rm = remain%60;
            // number after name (as you requested)
            active.push(`${p.name} (${p.rank}) ${rh>0?toPersianDigits(rh)+" ساعت و ":""}${toPersianDigits(rm)} دقیقه مانده`);
          }
        });
      });

      const shiftBox = $("#shift-list");
      if (active.length) {
        shiftBox.innerHTML = active.map(x=>`<div style="margin:6px 0;padding:8px;background:rgba(0,0,0,0.6);border-radius:8px">${x}</div>`).join("");
      } else {
        shiftBox.innerHTML = `<div style="padding:8px;background:rgba(0,0,0,0.35);border-radius:8px">در حال حاضر کسی در شیفت نیست</div>`;
      }
    }

    // If user already authed at load, init
    if (sessionStorage.getItem("taxi_auth") === "1") initApp();

    // Security note shown to user (optional)
    // console.warn("This login is client-side only. For real security use a server-side auth.");
  </script>
</body>
</html>
